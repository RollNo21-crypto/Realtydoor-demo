// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  AGENT
  ADMIN
}

enum PropertyType {
  HOUSE
  APARTMENT
  CONDO
  TOWNHOUSE
  VILLA
  LAND
  COMMERCIAL
}

enum PropertyStatus {
  AVAILABLE
  SOLD
  PENDING
  OFF_MARKET
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime? @map("email_verified")
  image         String?
  password      String
  role          UserRole  @default(USER)
  phone         String?
  bio           String?   @db.Text
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  properties Property[]  // Properties created by this user (if agent/admin)
  favorites  Favorite[]
  inquiries  Inquiry[]

  @@map("users")
}

model Property {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  price       Decimal  @db.Decimal(15, 2)
  
  // Location
  address     String
  city        String
  state       String
  zipCode     String   @map("zip_code")
  country     String   @default("USA")
  latitude    Float?
  longitude   Float?
  
  // Property Details
  propertyType PropertyType @map("property_type")
  status       PropertyStatus @default(AVAILABLE)
  bedrooms     Int
  bathrooms    Decimal @db.Decimal(3, 1)
  sqft         Int
  lotSize      Int?     @map("lot_size")
  yearBuilt    Int?     @map("year_built")
  
  // Features
  features     String[] // JSON array of features
  amenities    String[] // JSON array of amenities
  
  // Media
  images       PropertyImage[]
  virtualTourUrl String? @map("virtual_tour_url")
  
  // Metadata
  featured     Boolean  @default(false)
  views        Int      @default(0)
  
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  // Relations
  userId       String   @map("user_id")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  favorites    Favorite[]
  inquiries    Inquiry[]

  @@index([userId])
  @@index([city])
  @@index([propertyType])
  @@index([status])
  @@index([price])
  @@map("properties")
}

model PropertyImage {
  id         String   @id @default(cuid())
  url        String
  alt        String?
  caption    String?
  order      Int      @default(0)
  
  propertyId String   @map("property_id")
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([propertyId])
  @@map("property_images")
}

model Favorite {
  id         String   @id @default(cuid())
  
  userId     String   @map("user_id")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  propertyId String   @map("property_id")
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  createdAt  DateTime @default(now()) @map("created_at")

  @@unique([userId, propertyId])
  @@index([userId])
  @@index([propertyId])
  @@map("favorites")
}

model Inquiry {
  id         String   @id @default(cuid())
  name       String
  email      String
  phone      String?
  message    String   @db.Text
  status     String   @default("NEW") // NEW, CONTACTED, CLOSED
  
  userId     String?  @map("user_id")
  user       User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  propertyId String   @map("property_id")
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([propertyId])
  @@index([userId])
  @@index([status])
  @@map("inquiries")
}
